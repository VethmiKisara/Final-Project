{% extends "base.html" %}

{% block title %}Admin Sign Up - DisasterWatch{% endblock %}

{% block content %}
<div class="container">
    <div class="row align-items-center justify-content-center" style="min-height: calc(100vh - 200px);">
        <div class="col-md-5">
            <div class="card shadow-lg border-0">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-shield-alt fa-3x text-danger mb-3"></i>
                        <h3>Admin Registration</h3>
                        <p class="text-muted small">Create an administrator account</p>
                    </div>

                    <form id="adminSignupForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0">
                                    <i class="fas fa-user text-primary"></i>
                                </span>
                                <input type="text" class="form-control border-start-0" id="username" 
                                       placeholder="Choose a username" required minlength="3">
                            </div>
                            <small class="text-muted">Minimum 3 characters</small>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Email Address</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0">
                                    <i class="fas fa-envelope text-primary"></i>
                                </span>
                                <input type="email" class="form-control border-start-0" id="email" 
                                       placeholder="Enter your email" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="adminCode" class="form-label">Admin Registration Code</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0">
                                    <i class="fas fa-key text-primary"></i>
                                </span>
                                <input type="password" class="form-control border-start-0" id="adminCode" 
                                       placeholder="Enter admin registration code" required>
                            </div>
                            <small class="text-muted">Required to register as admin</small>
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0">
                                    <i class="fas fa-key text-primary"></i>
                                </span>
                                <input type="password" class="form-control border-start-0" id="password" 
                                       placeholder="Create a password" required minlength="6">
                                <button type="button" class="btn btn-light" id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <small class="text-muted">Minimum 6 characters</small>
                        </div>

                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0">
                                    <i class="fas fa-key text-primary"></i>
                                </span>
                                <input type="password" class="form-control border-start-0" id="confirmPassword" 
                                       placeholder="Confirm your password" required>
                            </div>
                        </div>

                        <div class="mb-3 p-3 bg-light rounded border-start border-4 border-danger">
                            <small class="text-danger fw-bold">
                                <i class="fas fa-exclamation-triangle me-2"></i>Admin Access Notice
                            </small>
                            <p class="text-muted small mb-0 mt-2">
                                You are registering for an admin account with elevated privileges. Admin credentials must be kept secure.
                            </p>
                        </div>

                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="agreeTerms" required>
                            <label class="form-check-label" for="agreeTerms">
                                I agree to the <a href="#" class="text-primary text-decoration-none">Terms and Conditions</a>
                            </label>
                        </div>

                        <button type="submit" class="btn btn-danger btn-lg w-100">
                            <i class="fas fa-shield-alt me-2"></i>Create Admin Account
                        </button>
                    </form>

                    <hr>

                    <p class="text-center text-muted small mb-0">
                        Not an admin? 
                        <a href="/signup/user" class="text-primary text-decoration-none fw-bold">Sign up as user</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Redirect if already logged in
        if (sessionStorage.getItem('isLoggedIn') === 'true') {
            window.location.href = '/dashboard';
            return;
        }

        const form = document.getElementById('adminSignupForm');
        const toggleButton = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');

        // Toggle password visibility
        toggleButton.addEventListener('click', function() {
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
            this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        });

        // Handle form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const adminCode = document.getElementById('adminCode').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;

            // Validation
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (!agreeTerms) {
                alert('You must agree to the terms and conditions');
                return;
            }

            // Simulate admin code validation (any 4+ characters work)
            if (adminCode.length < 4) {
                alert('Invalid admin registration code');
                return;
            }

            if (username && email && password) {
                // Store login info in sessionStorage
                sessionStorage.setItem('isLoggedIn', 'true');
                sessionStorage.setItem('userName', username);
                sessionStorage.setItem('isAdmin', 'true');

                // Show success message
                const btn = form.querySelector('button[type="submit"]');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check me-2"></i>Admin Account Created!';
                btn.disabled = true;

                // Redirect after 1.5 seconds
                setTimeout(() => {
                    window.location.href = '/dashboard';
                }, 1500);
            }
        });
    });
</script>
{% endblock %}
